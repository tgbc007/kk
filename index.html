<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频播放APP</title>
    <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
    <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.14/dist/hls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; }
        .ad-slot { 
            width: 100%; 
            height: 100px; 
            line-height: 100px; 
            text-align: center; 
            border: 2px dashed #ff6700; 
            color: #ff6700; 
            font-size: 18px; 
            margin-bottom: 20px; 
            background: #fff8f0;
        }
        .player-container { 
            position: relative; 
            width: 100%; 
            max-width: 1200px; 
            margin: 0 auto; 
            aspect-ratio: 16/9; 
            background: #ccc; 
        }
        .video-js .vjs-download-control { display: none !important; }
        .btn-group { 
            max-width: 1200px; 
            margin: 15px auto; 
            display: flex; 
            gap: 15px; 
        }
        .next-btn, .group-btn { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 16px; 
            color: #fff; 
        }
        .next-btn { background: #2c3e50; }
        .group-btn { background: #e74c3c; }
        .video-list { 
            max-width: 1200px; 
            margin: 20px auto; 
            border: 1px solid #eee; 
            border-radius: 4px; 
            overflow: hidden; 
            display: none;
        }
        .list-header { 
            padding: 12px; 
            background: #f5f5f5; 
            font-weight: bold; 
        }
        .list-item { 
            padding: 12px; 
            display: flex; 
            align-items: center; 
            border-top: 1px solid #eee; 
            cursor: pointer;
        }
        .list-item:hover { background: #fafafa; }
        .date-red { color: #e74c3c; margin-left: 8px; }
        .load-tip { 
            text-align: center; 
            padding: 20px; 
            color: #666; 
            max-width: 1200px; 
            margin: 0 auto; 
            display: none;
        }
    </style>
</head>
<body>
    <div class="ad-slot">【广告位招租】</div>
    <div class="player-container">
        <video id="video-player" class="video-js vjs-big-play-centered" controls preload="auto"></video>
    </div>
    <div class="btn-group">
        <button class="next-btn" onclick="playNextVideo()">下一个视频</button>
        <button class="group-btn" onclick="window.open('https://qun.qq.com/universal-share/share?ac=1&authKey=bH%2B1KyzX4WfhLWw1DijY0fE4UkVhnwegk1RB9LxR%2FqfVVvV6dWOqBO0CAjZiLAId&busi_data=eyJncm91cENvZGUiOiI3MzMzMTQ3NjQiLCJ0b2tlbiI6ImFIYjdMcDhsdnlqSEc4NjRIMmZ3SDIvZkc0S2dSenRnWXFVbFVzM01HQmwwT25TY3IyK1pRMVN1N21FNzFib20iLCJ1aW4iOiIxNzk1ODUyNTU5In0%3D&data=urNE9WigmXAvr-uFjHCIN7gLzULuz2itgIkc0Bxt07ytjRpFVb1nwiH7miG-PFobwd2AWThYePcOpnQq79PS9w&svctype=4&tempid=h5_group_info', '_blank')">加群获取最新资源</button>
    </div>
    <div class="load-tip" id="load-tip">正在加载视频列表，请稍候...</div>
    <div class="video-list" id="video-list">
        <div class="list-header">视频列表</div>
        <div id="list-container"></div>
    </div>
    <script>
        let videoList = [];
        let currentIndex = 0;
        const EXCEL_FILE_URL = "https://tgbc007.github.io/kk/video-list.xlsx";
        
        // 初始化播放器
        const player = videojs('video-player', {
            autoplay: false,
            controls: true,
            responsive: true,
            fluid: true,
            sources: [],
            controlBar: { downloadControl: false },
            muted: false
        });
        
        // 页面加载完成后加载视频列表
        window.onload = function() {
            loadExcelFromServer();
            document.getElementById('load-tip').style.display = "block";
        };
        
        // 加载Excel视频列表
        function loadExcelFromServer() {
            fetch(EXCEL_FILE_URL)
                .then(response => response.arrayBuffer())
                .then(buffer => {
                    const workbook = XLSX.read(new Uint8Array(buffer), { type: 'array' });
                    const jsonData = XLSX.utils.sheet_to_json(
                        workbook.Sheets[workbook.SheetNames[0]],
                        { header: ['序号', '视频名称', '视频地址', '添加日期'], skipEmptyRows: true }
                    );
                    videoList = jsonData.slice(1).filter(item => item['视频地址']);
                    if (videoList.length > 0) {
                        renderVideoList();
                        playVideo(0);
                        document.getElementById('load-tip').style.display = "none";
                        document.getElementById('video-list').style.display = "block";
                    } else {
                        document.getElementById('load-tip').textContent = "Excel中无有效视频";
                    }
                })
                .catch(error => {
                    document.getElementById('load-tip').textContent = `加载失败：${error.message}`;
                });
        }
        
        // 渲染视频列表
        function renderVideoList() {
            const container = document.getElementById('list-container');
            container.innerHTML = '';
            videoList.forEach((item, index) => {
                const listItem = document.createElement('div');
                listItem.className = 'list-item';
                listItem.onclick = () => playVideo(index);
                listItem.innerHTML = `
                    <span style="width: 60px; margin-right: 15px;">${item['序号'] || index + 1}</span>
                    <span>${item['视频名称'] || '未命名'}<span class="date-red">(${item['添加日期'] || '未知'})</span></span>
                `;
                container.appendChild(listItem);
            });
        }
        
        // 播放指定索引的视频
        function playVideo(index) {
            if (index < 0 || index >= videoList.length) return;
            currentIndex = index;
            const video = videoList[index];
            player.pause();
            player.src({
                src: video['视频地址'],
                type: video['视频地址'].endsWith('.m3u8') ? 'application/x-mpegURL' : 'video/mp4'
            });
            player.load();
            player.play();
            // 高亮当前播放项
            document.querySelectorAll('.list-item').forEach((item, i) => {
                item.style.background = i === currentIndex ? '#e3f2fd' : 'transparent';
            });
        }
        
        // 播放下一个视频
        function playNextVideo() {
            const nextIndex = currentIndex + 1 >= videoList.length ? 0 : currentIndex + 1;
            playVideo(nextIndex);
        }
    </script>
</body>
</html>
